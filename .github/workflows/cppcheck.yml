---
name: cppcheck

on:
  push:

jobs:
  cppcheck:
    name: Run cppcheck

    runs-on: ubuntu-latest

    container:
      image: fedora:latest

    steps:
      - name: Update OS
        run: dnf upgrade -y

      - name: Install cppcheck and dependencies
        run: dnf install cppcheck perl pkgconf -y

      - name: Checkout buildbot-utils
        uses: actions/checkout@v3
        with:
          repository: MythTV/buildbot-utils

      - name: Checkout Mythtv/mythtv
        uses: actions/checkout@v3
        with:
          repository: MythTV/mythtv

      - name: show vars
        run: |
          pwd
          ls -alt
          ls -alt mythtv
          ls -alt buildbot-utils

      - name: Run cppcheck
        working-directory: ./mythtv
        run: ../buildbot-utils/cppcheck/run_cppcheck.sh

      - name: Generate report
        working-directory: ./mythtv
        run: ../buildbot-utils/cppcheck/generate_cppcheck_report.pl cppcheck.xml index.html
