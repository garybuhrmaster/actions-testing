---
name: build

on:

  push:
    branches: [main]

  pull_request:
    branches: [main]

jobs:

  deb-build:

    name: Build on ${{ matrix.container }}

    runs-on: ubuntu-latest

    strategy:
      matrix:
        container:
        - ubuntu:16.04
        - ubuntu:18.04
        - ubuntu:20.04
        - ubuntu:21.10
        - ubuntu:22.04

    container:
      image: ${{ matrix.container }}

    steps:
    - run: cat /etc/debian_version
    - run: apt-get update
    - run: apt-get upgrade
    - run: apt-get install ansible
    - run: ansible-playbook ci/ansible-playbooks/playbook.yaml

  rpm-build:

    name: Build on ${{ matrix.container }}

    runs-on: ubuntu-latest

    strategy:
      matrix:
        container:
        - redhat/ubi7/ubi
        - redhat/ubi8/ubi
        - fedora:34
        - fedora:35
        - fedora:36

    container:
      image: ${{ matrix.container }}

    steps:
    - run: cat /etc/os-release
    - run: dnf -y upgrade
    - run: dnf -y install ansible
    - run: ansible-playbook ci/ansible-playbooks/playbook.yaml

  windows-build:

    name: Build on Windows

    runs-on: windows-latest

    steps:

      - name: perl -V
        run: perl -V

