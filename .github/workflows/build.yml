---
name: build

on:

  push:
    branches: [main]

  pull_request:
    branches: [main]

jobs:

  deb-build:

    name: Debian build on ${{ matrix.container }}

    runs-on: ubuntu-latest

    strategy:
      matrix:
        container:
        - ubuntu:16.04
        - ubuntu:18.04
        - ubuntu:20.04
        - ubuntu:21.10
        - ubuntu:22.04
      fail-fast: false

    container:
      image: ${{ matrix.container }}

    steps:
    - uses: actions/checkout@v3
    - run: apt-get update
    - run: apt-get -y upgrade
    - run: apt-get -y install ansible
    - run: ansible-playbook ci/ansible-playbooks/playbook.yml

  el-build:

    name: EL build on ${{ matrix.container }}

    runs-on: ubuntu-latest

    strategy:
      matrix:
        container:
        - centos:7
        - redhat/ubi8
      fail-fast: false

    container:
      image: ${{ matrix.container }}

    steps:
    - uses: actions/checkout@v3
    - run: yum -y upgrade
    - run: yum --enablerepo=extras -y install ansible
    - run: ansible-playbook ci/ansible-playbooks/playbook.yml

  fedora-build:

    name: Fedora build on ${{ matrix.container }}

    runs-on: ubuntu-latest

    strategy:
      matrix:
        container:
        - fedora:34
        - fedora:35
        - fedora:36
      fail-fast: false

    container:
      image: ${{ matrix.container }}

    steps:
    - uses: actions/checkout@v3
    - run: dnf -y upgrade
    - run: dnf -y install ansible
    - run: ansible-playbook ci/ansible-playbooks/playbook.yml

  windows-build:

    name: Build on Windows

    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3
      - name: perl -V
        run: perl -V

